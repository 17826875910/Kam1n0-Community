<!DOCTYPE html >
<html>
<head>
    <meta charset="UTF-8">
    <title>DMaS-McGill | Kam1n0 </title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <!-- bootstrap 3.0.2 -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <!-- font Awesome -->
    <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <!-- Ionicons -->
    <link href="css/ionicons.min.css" rel="stylesheet" type="text/css"/>


    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon"/>

    <!-- style sheet for tipsy.css tool tips-->
    <link href="css/tipsy.css" rel="stylesheet" type="text/css"/>


    <!-- bootstrap slider -->
    <link href="css/bootstrap-slider/slider2.css" rel="stylesheet" type="text/css"/>

    <!-- bootstrap tree -->
    <link href="css/tree.css" rel="stylesheet" type="text/css"/>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <style>


        .node rect {
        stroke: #333;
        fill: #fff;
        }

        .edgePath path {
        fill: #333;
        stroke-width: 1.5px;
        }

        /* This styles the body of the tooltip */
        .tipsy {
        font-size: 1.1em;
        test-align: left;
        }

        .progress {
        background-color: #2B084E;
        }

        .line-nums {
        font-size: 13px;
        line-height: 13px;
        padding: 10px 4px;
        font-family: monospace;
        background: #EEE;
        position: absolute;
        width: 30px;
        left: -0.5px;
        bottom: 0;
        top: 15px;
        text-align: right;
        margin-left: 5px;
        }

        .glyphicon-refresh-animate {
        -animation: spin .7s infinite linear;
        -webkit-animation: spin2 .7s infinite linear;
        }

        @-webkit-keyframes spin2 {
        from {
        -webkit-transform: rotate(0deg);
        }
        to {
        -webkit-transform: rotate(360deg);
        }
        }

        @keyframes spin {
        from {
        transform: scale(1) rotate(0deg);
        }
        to {
        transform: scale(1) rotate(360deg);
        }
        }

        #headerTitle {
        font-family: 'Antic Slab', serif;
        font-size: 100px;
        color: #DDCCEE;
        }

        .lead {
        color: #DDCCEE;
        }

        /* Custom container */
        .container-full {
        margin: 0 auto;
        width: 100%;
        min-height: 100%;
        background-color: #110022;
        color: #eee;
        overflow: hidden;
        }

        .container-full a {
        color: #efefef;
        text-decoration: none;
        }

        .v-center {
        margin-top: 7%;
        }

        #inputbox {

        /* The following three rules make a difference in the script */
        overflow: hidden;
        line-height: 18px;
        font-size: 15px;

        font-family: 'Antic Slab', serif;
        color: rgb(1, 255, 45);
        max-width: 850px;
        min-width: 850px;
        min-height: 200px;
        width: 850px;
        overflow: auto;
        background-color: black;
        }

        .input-container {
        position: relative;
        display: inline-block;
        }

        .line-nums {
        font-size: 15px;
        color: #DDCCEE;
        line-height: 18px;
        padding: 10px 4px;
        font-family: monospace;
        background-color: rgb(43, 8, 78);
        position: absolute;
        width: 29px;
        left: -36px;
        bottom: 0;
        top: 0;
        text-align: right;
        }

        .glyphicon-refresh-animate {
        -animation: spin .7s infinite linear;
        -webkit-animation: spin2 .7s infinite linear;
        }

        @-webkit-keyframes spin2 {
        from {
        -webkit-transform: rotate(0deg);
        }
        to {
        -webkit-transform: rotate(360deg);
        }
        }

        @keyframes spin {
        from {
        transform: scale(1) rotate(0deg);
        }
        to {
        transform: scale(1) rotate(360deg);
        }
        }

        .logoImg {
        height: 80px;
        position: relative;
        top: -30px;
        }

        /* layout.css Style */
        .upload-drop-zone {
        height: 200px;
        border-width: 2px;
        margin-bottom: 20px;
        }

        /* skin.css Style*/
        .upload-drop-zone {
        color: rgb(1, 255, 45);
        background-color: black;
        border-style: dashed;
        border-color: #534661;
        line-height: 200px;
        text-align: center
        }

        .upload-drop-zone.drop {
        color: rgb(1, 255, 45);
        border-color: #222;
        }

        .slider.slider-vertical {
        height: 100%;
        }

        /* slider color*/

        #GC .slider-handle {
        border-radius: 0%;
        margin-left: 0px;
        margin-top: 0px;
        width: 10px;
        }

        /* diff text */
        td.diff-line-content {
        padding-left: 20px;
        padding-right: 10px;
        vertical-align: top;
        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
        font-size: 12px;
        }

        td.diff-line-content.remove {
        background-color: #ffecec;
        }

        td.diff-line-content.add {
        background-color: #eaffea;
        }

        td.diff-line-content.empty {
        background-color: #fafafa;
        min-height: 20px;
        }

        td.diff-line-num {
        width: 6%;
        min-width: 50px;
        white-space: nowrap;
        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
        font-size: 12px;
        line-height: 18px;
        color: rgba(0, 0, 0, 0.3);
        vertical-align: top;
        text-align: right;
        border: solid #eee;
        border-width: 0 1px 0 0;
        cursor: pointer;
        border-left-width: 1px;
        padding-left: 10px;
        padding-right: 10px;
        }

        td.diff-line-num.selected {
        background-color: rgba(255, 165, 0, 0.1);
        }
        td.diff-line-num.empty.selected {
        background-color: rgba(255, 165, 0, 0.1);
        }

        td.diff-line-num:hover {
        color: rgba(0, 0, 0, 0.67);
        }

        td.diff-line-num.empty {
        background-color: #fafafa;
        height: 20px;
        }

        span.m {
        color: #a71d5d;
        display: inline-block;
        width: 50px;
        }

        table.block {
        border-color: gray;
        display: table;
        width: 100%;
        border-spacing: 2px;
        border-right: solid 1px #eee;
        }

        div.sep {
        background-color: #fafafa;
        color: rgba(0, 0, 0, 0.53);
        padding-left: 10px;
        line-height: 18px;
        font-size: 12px;
        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
        border-right: solid 1px #eee;
        border-left: solid 3px #837979;
        }

        span.commenter {
        position: relative;
        z-index: 5;
        float: right;
        font-size: 16px;
        width: 20px;
        height: 20px;
        margin: -1px -25px -1px -10px;
        line-height: 20px;
        color: #fff;
        text-align: center;
        text-indent: 0;
        cursor: pointer;
        background-color: orange;
        border-radius: 3px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
        opacity: 0;
        -webkit-transform: scale(0.8, 0.8);
        -ms-transform: scale(0.8, 0.8);
        transform: scale(0.8, 0.8);
        -webkit-transition: -webkit-transform 0.1s ease-in-out;
        transition: transform 0.1s ease-in-out;
        }

        span.commenter.selected {
        opacity: 1.0;
        transform: scale(1.0, 1.0);
        }

        div.cmbox{
        color: rgba(0, 145, 22, 1);
        padding-left: 10px;
        line-height: 18px;
        font-size: 12px;
        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
        border-left: solid 2px rgba(0, 141, 15, 0.44);
        }

        div.cmbox>p{
        margin-bottom:0px;
        }

        tr.comrow{

        }

        span.delete{
        font-size: 13px;
        margin-left:4px;
        cursor: pointer;
        color: rgb(188, 188, 188);
        }

    </style>
</head>
<body>
<div style="height:100%">
    <div class="box box-info collapsed-box" id="textViewDiff">
        <div class="box-body no-padding">
            <div style="padding-left: 20px;background-color: #f7f7f7;border: 1px solid #d8d8d8;padding:5px;border-top-left-radius: 2px;border-top-right-radius: 2px;margin-left:10px;margin-right:10px;">
                <span id="diff-title"></span>
            </div>
            <div style="margin-left:10px;margin-right:10px;height:800px;">
                <table id="diff-table"
                       style="border-color: gray;display:table;width: 100%;  border-spacing: 2px;  border-right: solid 1px #eee; border-bottom: solid 1px #eee;">
                    <colgroup>
                        <col width="44">
                        <col>
                        <col width="44">
                        <col>
                    </colgroup>
                    <tbody>
                    <tr>

                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- jQuery 2.0.2 -->
<script src="js/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<!-- DATA TABES SCRIPT -->
<script src="js/plugins/datatables/jquery.dataTables.js" type="text/javascript"></script>

<!-- Bootstrap -->
<script src="js/bootstrap.min.js" type="text/javascript"></script>

<!-- Forcegraph -->
<script src="js/d3.v3.min.js"></script>
<script src="js/dagre-d3.js"></script>
<script src="js/jquery.tipsy.js"></script>

<!-- Convex hull -->
<script src="js/graham_scan.min.js"></script>

<!-- Bootstrap slider -->
<script src="js/plugins/bootstrap-slider/bootstrap-slider2.js" type="text/javascript"></script>
<!-- Text Compare -->
<script src="resources/diff.js"></script>

<!-- Page script -->
<script type="text/javascript">

    var clonePartColors = d3.scale.category20c().range();


    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1);
            if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
        }
        return "";
    }

    var QueryString = function () {
        // This function is anonymous, is executed immediately
        var query_string = {};
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            // If first entry with this name
            if (typeof query_string[pair[0]] === "undefined") {
                query_string[pair[0]] = pair[1];
                // If second entry with this name
            } else if (typeof query_string[pair[0]] === "string") {
                var arr = [query_string[pair[0]], pair[1]];
                query_string[pair[0]] = arr;
                // If third or later entry with this name
            } else {
                query_string[pair[0]].push(pair[1]);
            }
        }
        return query_string;
    }();

    function drawTextDiff(p_a, p_b) {
        $('#diff-title').html(
                p_a.functionName + "(#" + p_a.functionId.toString(16) + ")@" + p_a.binaryName + "(#" + p_a.binaryId.toString(16)
                + ")           compares to            " +
                p_b.functionName + "(#" + p_b.functionId.toString(16) + ")@" + p_b.binaryName + "(#" + p_b.binaryId.toString(16)
                + ")"
        );

        var code_a = "", code_b = "";
        var addr_a = [], addr_b = [];
        var addr_ind_a = 0, addr_ind_b = 0;
        for (var i = 0; i < p_a.nodes.length; ++i) {
            for (var j = 0; j < p_a.nodes[i].srcCodes.length; ++j) {
                var parts = p_a.nodes[i].srcCodes[j].split(' ');
                addr_a.push(parts[0]);
                code_a += p_a.nodes[i].srcCodes[j].replace(parts[0], "").replace(/\s{2,}/g, ' ') + "\r\n";
            }
        }

        for (var i = 0; i < p_b.nodes.length; ++i) {
            for (var j = 0; j < p_b.nodes[i].srcCodes.length; ++j) {
                var parts = p_b.nodes[i].srcCodes[j].split(' ');
                addr_b.push(parts[0]);
                code_b += p_b.nodes[i].srcCodes[j].replace(parts[0], "").replace(/\s{2,}/g, ' ') + "\r\n";
            }
        }

        var cache = [];
        var index = -1;
        var diff = JsDiff.diffTrimmedLines(code_a, code_b);
        $("#diff-table").find("tr").remove();
        var tbl = $('#diff-table > tbody:last');
        for (var i = 0; i < diff.length; i++) {
            // put remove ahead e.g.
            // rm rm rm rm add add add ...
            if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                var swap = diff[i];
                diff[i] = diff[i + 1];
                diff[i + 1] = swap;
            }

            var lines = diff[i].value.match(/[^\r\n]+/g);
            if (lines == null)
                continue;
            for (var j = 0; j < lines.length; ++j) {
                var line = lines[j];
                if (diff[i].removed) {
                    var $newRow = $('<tr>');
                    $newRow.append($('<td class=\'diff-line-num\'>').append(addr_a[addr_ind_a++]).append($('<span class=\'commenter\'>').append('+')));
                    var parts = line.split(' ');
                    $newRow.append($('<td class=\'diff-line-content remove\'>').append('-').append(
                                    $('<span class="m">').append(parts[0])
                            ).append(' ').append(
                                    $('<span class="o">').append(parts.slice(1, parts.length).join(' '))
                            )
                    );
                    cache.push($newRow);
                    if (index == -1)
                        index = 0;
                } else if (diff[i].added) {
                    if (index != -1 && index < cache.length) {
                        cache[index].append($('<td class=\'diff-line-num\'>').append(addr_b[addr_ind_b++]).append($('<span class=\'commenter\'>').append('+')));
                        var parts = line.split(' ');
                        cache[index].append($('<td class=\'diff-line-content add\'>').append('+').append(
                                        $('<span class="m">').append(parts[0])
                                ).append(' ').append(
                                        $('<span class="o">').append(parts.slice(1, parts.length).join(' '))
                                )
                        );
                        index++;
                    } else {
                        if (cache.length > 0) {
                            for (var k = 0; k < cache.length; ++k) {
                                tbl.append(cache[k]);
                            }
                            cache = [];
                            index = -1;
                        }
                        var $newRow = $('<tr>');
                        $newRow.append($('<td class=\'diff-line-num empty\'>'));
                        $newRow.append($('<td class=\'diff-line-content empty\'>'));
                        $newRow.append($('<td class=\'diff-line-num\'>').append(addr_b[addr_ind_b++]).append($('<span class=\'commenter\'>').append('+')));
                        var parts = line.split(' ');
                        $newRow.append($('<td class=\'diff-line-content add\'>').append('+').append(
                                        $('<span class="m">').append(parts[0])
                                ).append(' ').append(
                                        $('<span class="o">').append(parts.slice(1, parts.length).join(' '))
                                )
                        );
                        tbl.append($newRow)
                    }
                } else {
                    if (cache.length > 0) {
                        for (var k = 0; k < cache.length; ++k) {
                            if (cache[k].children().length == 2) {
                                cache[k].append($('<td class=\'diff-line-num empty\'>'));
                                cache[k].append($('<td class=\'diff-line-content empty\'>'));
                            }
                            tbl.append(cache[k]);
                        }
                        cache = [];
                        index = -1;
                    }
                    var $newRow = $('<tr>');
                    var parts = line.split(' ');
                    $newRow.append($('<td class=\'diff-line-num\'>').append(addr_a[addr_ind_a++]).append($('<span class=\'commenter\'>').append('+')));
                    $newRow.append($('<td class=\'diff-line-content\'>').append('&nbsp;').append(
                                    $('<span class="m">').append(parts[0])
                            ).append(' ').append(
                                    $('<span class="o">').append(parts.slice(1, parts.length).join(' '))
                            )
                    );
                    $newRow.append($('<td class=\'diff-line-num\'>').append(addr_b[addr_ind_b++]).append($('<span class=\'commenter\'>').append('+')));
                    $newRow.append($('<td class=\'diff-line-content\'>').append('&nbsp;').append(
                                    $('<span class="m">').append(parts[0])
                            ).append(' ').append(
                                    $('<span class="o">').append(parts.slice(1, parts.length).join(' '))
                            )
                    );
                    tbl.append($newRow);
                }
            }
        }
        if (cache.length > 0) {
            for (var k = 0; k < cache.length; ++k) {
                if (cache[k].children().length == 2) {
                    cache[k].append($('<td class=\'diff-line-num empty\'>'));
                    cache[k].append($('<td class=\'diff-line-content empty\'>'));
                }
                tbl.append(cache[k]);
            }
            cache = [];
            index = -1;
        }
    }




    var pb_fun;
    var pa_fun;
    function callBack(funcb){
        pb_fun = $.parseJSON(funcb);
        drawTextDiff(pa_fun, pb_fun);
    }



     var gd;
     window.onload = function(){
        //var dataParsed = $.parseJSON(window.params);
        //CreateCloneGraph(dataParsed);
        // alert(window.GData);
        //alert(window.params);



        gd =  $.parseJSON(window.GData);

        p_a = window.params[0];
        p_b = window.params[1];
        var p_b_param = gd.results[p_a].clones[p_b].functionIdStr;
        pa_fun = gd.results[p_a].function;
        external.GetFunc(p_b_param, callBack);

     }






</script>
</body>
</html> 